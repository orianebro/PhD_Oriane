<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Light interception with Caribu – PhD Oriane</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./year_2.html" rel="next">
<link href="./algo_leaf_growth.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-78faf54a06e50be45dc6d83ab59297a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./year_1.html">First chapter: Analyzing accuracy of formalisms in crop model when adding shoot structural variability</a></li><li class="breadcrumb-item"><a href="./light_inter.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Light interception with Caribu</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PhD Oriane</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./abstract.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Abstract</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./year_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">First chapter: Analyzing accuracy of formalisms in crop model when adding shoot structural variability</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./structural_cereal_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Structural cereal model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./algo_leaf_growth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Algorithm for leaf growth</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./light_inter.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Light interception with Caribu</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./year_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Second chapter : Analyzing accuracy of formalisms in crop model when adding root structural variability</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./year_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Third chapter: Improving STICS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#retrieve-stics-dynamics-from-file" id="toc-retrieve-stics-dynamics-from-file" class="nav-link active" data-scroll-target="#retrieve-stics-dynamics-from-file"><span class="header-section-number">5.1</span> Retrieve STICS dynamics from file</a></li>
  <li><a href="#vary-chosen-architectural-and-developmental-parameters-and-select-the-sets-of-parameters-that-make-the-model-fit" id="toc-vary-chosen-architectural-and-developmental-parameters-and-select-the-sets-of-parameters-that-make-the-model-fit" class="nav-link" data-scroll-target="#vary-chosen-architectural-and-developmental-parameters-and-select-the-sets-of-parameters-that-make-the-model-fit"><span class="header-section-number">5.2</span> Vary chosen architectural and developmental parameters and select the sets of parameters that make the model fit</a></li>
  <li><a href="#within-this-space-of-possible-plant-architectures-regarding-parameters-affecting-plant-leaf-area-and-height-throught-time-we-vary-parameters-related-to-the-orientation-of-the-leaves-in-space-and-to-crop-spatial-configuration." id="toc-within-this-space-of-possible-plant-architectures-regarding-parameters-affecting-plant-leaf-area-and-height-throught-time-we-vary-parameters-related-to-the-orientation-of-the-leaves-in-space-and-to-crop-spatial-configuration." class="nav-link" data-scroll-target="#within-this-space-of-possible-plant-architectures-regarding-parameters-affecting-plant-leaf-area-and-height-throught-time-we-vary-parameters-related-to-the-orientation-of-the-leaves-in-space-and-to-crop-spatial-configuration."><span class="header-section-number">5.3</span> Within this space of possible plant architectures regarding parameters affecting plant leaf area and height throught time, we vary parameters related to the orientation of the leaves in space and to crop spatial configuration.</a></li>
  <li><a href="#stand" id="toc-stand" class="nav-link" data-scroll-target="#stand"><span class="header-section-number">5.4</span> Stand</a></li>
  <li><a href="#compute-par-intercepted" id="toc-compute-par-intercepted" class="nav-link" data-scroll-target="#compute-par-intercepted"><span class="header-section-number">5.5</span> Compute PAR intercepted</a></li>
  <li><a href="#compute-beer-lambert-light-extinction-coefficient-at-each-time-step" id="toc-compute-beer-lambert-light-extinction-coefficient-at-each-time-step" class="nav-link" data-scroll-target="#compute-beer-lambert-light-extinction-coefficient-at-each-time-step"><span class="header-section-number">5.6</span> Compute Beer-Lambert light extinction coefficient at each time step</a>
  <ul class="collapse">
  <li><a href="#light-interception-in-stics" id="toc-light-interception-in-stics" class="nav-link" data-scroll-target="#light-interception-in-stics"><span class="header-section-number">5.6.1</span> Light interception in STICS</a></li>
  </ul></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">5.7</span> Next steps</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./year_1.html">First chapter: Analyzing accuracy of formalisms in crop model when adding shoot structural variability</a></li><li class="breadcrumb-item"><a href="./light_inter.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Light interception with Caribu</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Light interception with Caribu</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="263736d4-d5e9-4bb6-9f88-83be3716703c" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Imports</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time <span class="im">as</span> t</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> random <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> qmc</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> oawidgets.plantgl <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openalea.plantgl.<span class="bu">all</span> <span class="im">import</span> Material, Color3, Scene, Viewer</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> alinea.astk <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openalea.archicrop.display <span class="im">import</span> build_scene</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openalea.archicrop.simulation <span class="im">import</span> retrieve_stics_dynamics_from_file, dict_ranges_to_all_possible_combinations, generate_single_list_dicts, LHS_param_sampling, params_for_curve_fit</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openalea.archicrop.archicrop <span class="im">import</span> ArchiCrop</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openalea.archicrop.plant_shape <span class="im">import</span> compute_leaf_area_growing_plant, compute_height_growing_plant</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openalea.archicrop.light_it <span class="im">import</span> compute_light_inter</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openalea.archicrop.stand <span class="im">import</span> agronomic_plot</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable plotting with PlantGL</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>gui qt</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Set nice color for plants</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>nice_green<span class="op">=</span>Color3((<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="retrieve-stics-dynamics-from-file" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="retrieve-stics-dynamics-from-file"><span class="header-section-number">5.1</span> Retrieve STICS dynamics from file</h2>
<div id="aa94ef44-1046-4577-9284-c6c446a3f769" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>stics_output_file <span class="op">=</span> <span class="st">'mod_ssorghum.sti'</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sowing_density <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>inter_row <span class="op">=</span> <span class="fl">0.4</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>stics_output_data <span class="op">=</span> retrieve_stics_dynamics_from_file(stics_output_file, sowing_density)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> [value[<span class="st">"Thermal time"</span>] <span class="cf">for</span> value <span class="kw">in</span> stics_output_data.values()]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>LA_stics <span class="op">=</span> [value[<span class="st">"Plant leaf area"</span>] <span class="cf">for</span> value <span class="kw">in</span> stics_output_data.values()]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>height_stics <span class="op">=</span> [value[<span class="st">"Plant height"</span>] <span class="cf">for</span> value <span class="kw">in</span> stics_output_data.values()]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>par_stics <span class="op">=</span> [value[<span class="st">"Absorbed PAR"</span>] <span class="cf">for</span> value <span class="kw">in</span> stics_output_data.values()]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>height_potential_plant <span class="op">=</span> <span class="bu">max</span>(height_stics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vary-chosen-architectural-and-developmental-parameters-and-select-the-sets-of-parameters-that-make-the-model-fit" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="vary-chosen-architectural-and-developmental-parameters-and-select-the-sets-of-parameters-that-make-the-model-fit"><span class="header-section-number">5.2</span> Vary chosen architectural and developmental parameters and select the sets of parameters that make the model fit</h2>
<div id="194a756a-72d7-4d20-aab4-cd2c949b2e3b" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define parameter bounds </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For sorghum</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>archi_params <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    nb_phy <span class="op">=</span> [<span class="dv">10</span>,<span class="dv">30</span>], <span class="co"># [10,15,20,25,30], </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    max_leaf_length <span class="op">=</span> [<span class="dv">50</span>,<span class="dv">120</span>], </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    wl <span class="op">=</span> [<span class="fl">0.1</span>,<span class="fl">0.12</span>], </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    diam_base <span class="op">=</span> <span class="fl">2.2</span>, </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    diam_top <span class="op">=</span> <span class="fl">1.5</span>, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    insertion_angle <span class="op">=</span> <span class="dv">30</span>, <span class="co"># to vary for light interception</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    scurv <span class="op">=</span> <span class="fl">0.7</span>, <span class="co"># to vary for light interception</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    curvature <span class="op">=</span> <span class="dv">90</span>, <span class="co"># to vary for light interception</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    alpha <span class="op">=</span> <span class="op">-</span><span class="fl">2.3</span>, </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    stem_q <span class="op">=</span> [<span class="fl">1.01</span>,<span class="fl">1.2</span>], </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    rmax <span class="op">=</span> [<span class="fl">0.6</span>,<span class="fl">0.9</span>], <span class="co"># 1-(1/3*(nb_phy - 5)/nb_phy) </span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    skew <span class="op">=</span> [<span class="fl">0.01</span>, <span class="fl">0.1</span>], <span class="co"># 0.08 # 0.0005 </span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    phyllotactic_angle <span class="op">=</span> <span class="dv">180</span>, </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    phyllotactic_deviation <span class="op">=</span> <span class="dv">15</span>, <span class="co"># to vary for light interception</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    phyllochron <span class="op">=</span> [<span class="dv">30</span>,<span class="dv">46</span>],</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    plastochron <span class="op">=</span> [<span class="dv">30</span>,<span class="dv">46</span>],</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    leaf_duration <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">6</span>],</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    stem_duration <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">5</span>],</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    leaf_senescence <span class="op">=</span> [<span class="dv">550</span>, <span class="dv">900</span>]</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="754c883b-e38f-4257-a951-c6b241e9cd8a" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to process parameters and generate samples</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate parameter sets</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>param_sets <span class="op">=</span> LHS_param_sampling(archi_params, n_samples<span class="op">=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="3449d443-122f-496e-9f75-738f461dcc3e" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select parameters sets for which the model fits the LAI and the height curves of the crop model, with a given error.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Start the timer</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> t.time()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>fitting_sim <span class="op">=</span> params_for_curve_fit(param_sets, curves<span class="op">=</span>stics_output_data, error_LA<span class="op">=</span><span class="dv">200</span>, error_height<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># End the timer</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>end_time <span class="op">=</span> t.time()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate elapsed time</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>elapsed_time <span class="op">=</span> (end_time <span class="op">-</span> start_time)<span class="op">/</span><span class="dv">60</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Elapsed time: </span><span class="sc">{</span>elapsed_time<span class="sc">:.4f}</span><span class="ss"> minutes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Elapsed time: 43.0187 minutes</code></pre>
</div>
</div>
<div id="edde9564-6b2f-468d-8653-18b3311a2f8a" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure with two subplots side by side</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))  <span class="co"># 1 row, 2 columns</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot on the first subplot</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(time, LA_stics, color<span class="op">=</span><span class="st">"black"</span>, label<span class="op">=</span><span class="st">"LA STICS"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> result <span class="kw">in</span> fitting_sim[<span class="st">'LA'</span>]:</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].plot(time, result)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Thermal time (°C.day)"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Leaf Area / plant"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Leaf Area: 3D canopy vs. STICS"</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot on the second subplot</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(time, height_stics, color<span class="op">=</span><span class="st">"black"</span>, label<span class="op">=</span><span class="st">"height STICS"</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> result <span class="kw">in</span> fitting_sim[<span class="st">'height'</span>]:</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>].plot(time, result)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Thermal time (°C.day)"</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Plant height"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Plant height: 3D canopy vs. STICS"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend()</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="light_inter_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="9bddfeb2-f034-4aa8-808a-cf052e26c137" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>good_params <span class="op">=</span> fitting_sim[<span class="st">'params'</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>good_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>[{'diam_base': 2.2,
  'diam_top': 1.5,
  'insertion_angle': 30,
  'scurv': 0.7,
  'curvature': 90,
  'alpha': -2.3,
  'phyllotactic_angle': 180,
  'phyllotactic_deviation': 15,
  'nb_phy': 11,
  'max_leaf_length': 99.38953022234557,
  'wl': 0.10669701997307109,
  'stem_q': 1.1930546737497694,
  'rmax': 0.7975932479443661,
  'skew': 0.07599447227024302,
  'phyllochron': 40.10762088180296,
  'plastochron': 43.734086882182844,
  'leaf_duration': 3.745165180939094,
  'stem_duration': 2.6693719793972353,
  'leaf_senescence': 616.4863456859163},
 {'diam_base': 2.2,
  'diam_top': 1.5,
  'insertion_angle': 30,
  'scurv': 0.7,
  'curvature': 90,
  'alpha': -2.3,
  'phyllotactic_angle': 180,
  'phyllotactic_deviation': 15,
  'nb_phy': 13,
  'max_leaf_length': 118.1105694869254,
  'wl': 0.1093480966460198,
  'stem_q': 1.1497200137218366,
  'rmax': 0.8416458176468843,
  'skew': 0.08228427264284736,
  'phyllochron': 32.493791911914386,
  'plastochron': 43.56492110137314,
  'leaf_duration': 1.2016372244702727,
  'stem_duration': 3.734316120177147,
  'leaf_senescence': 650.8653645051161},
 {'diam_base': 2.2,
  'diam_top': 1.5,
  'insertion_angle': 30,
  'scurv': 0.7,
  'curvature': 90,
  'alpha': -2.3,
  'phyllotactic_angle': 180,
  'phyllotactic_deviation': 15,
  'nb_phy': 11,
  'max_leaf_length': 103.48584641182546,
  'wl': 0.10890929549672723,
  'stem_q': 1.1924904198138533,
  'rmax': 0.801533870017076,
  'skew': 0.08867506888742169,
  'phyllochron': 36.625128549162646,
  'plastochron': 42.20800198334537,
  'leaf_duration': 3.734386676241516,
  'stem_duration': 4.004192887644081,
  'leaf_senescence': 564.3730219089649},
 {'diam_base': 2.2,
  'diam_top': 1.5,
  'insertion_angle': 30,
  'scurv': 0.7,
  'curvature': 90,
  'alpha': -2.3,
  'phyllotactic_angle': 180,
  'phyllotactic_deviation': 15,
  'nb_phy': 10,
  'max_leaf_length': 92.22268298824724,
  'wl': 0.11091366426887748,
  'stem_q': 1.1433860724719365,
  'rmax': 0.771433756797771,
  'skew': 0.047435526778279426,
  'phyllochron': 44.45272651404066,
  'plastochron': 39.471730874055595,
  'leaf_duration': 5.4802652177158215,
  'stem_duration': 2.7834247369680067,
  'leaf_senescence': 658.8409166865579},
 {'diam_base': 2.2,
  'diam_top': 1.5,
  'insertion_angle': 30,
  'scurv': 0.7,
  'curvature': 90,
  'alpha': -2.3,
  'phyllotactic_angle': 180,
  'phyllotactic_deviation': 15,
  'nb_phy': 11,
  'max_leaf_length': 92.73439315497939,
  'wl': 0.11604108071175104,
  'stem_q': 1.0289385173595034,
  'rmax': 0.6177958466512076,
  'skew': 0.07019892739534422,
  'phyllochron': 41.49646808670554,
  'plastochron': 44.45599073202125,
  'leaf_duration': 5.382455026500954,
  'stem_duration': 2.5677463031300007,
  'leaf_senescence': 653.1045778015482},
 {'diam_base': 2.2,
  'diam_top': 1.5,
  'insertion_angle': 30,
  'scurv': 0.7,
  'curvature': 90,
  'alpha': -2.3,
  'phyllotactic_angle': 180,
  'phyllotactic_deviation': 15,
  'nb_phy': 14,
  'max_leaf_length': 92.83961596578551,
  'wl': 0.10031167052371445,
  'stem_q': 1.0590545596113439,
  'rmax': 0.7527045964023171,
  'skew': 0.02256555190068299,
  'phyllochron': 37.59576025447681,
  'plastochron': 34.21382895687567,
  'leaf_duration': 3.900290737357563,
  'stem_duration': 2.8780297055204076,
  'leaf_senescence': 871.8843364675288},
 {'diam_base': 2.2,
  'diam_top': 1.5,
  'insertion_angle': 30,
  'scurv': 0.7,
  'curvature': 90,
  'alpha': -2.3,
  'phyllotactic_angle': 180,
  'phyllotactic_deviation': 15,
  'nb_phy': 12,
  'max_leaf_length': 88.89606058255535,
  'wl': 0.11062711435124575,
  'stem_q': 1.1166192931631107,
  'rmax': 0.8666496205283223,
  'skew': 0.07490959075445477,
  'phyllochron': 35.88509350615921,
  'plastochron': 39.37937887515632,
  'leaf_duration': 3.9150978252799193,
  'stem_duration': 3.68072729459966,
  'leaf_senescence': 767.1221147790122},
 {'diam_base': 2.2,
  'diam_top': 1.5,
  'insertion_angle': 30,
  'scurv': 0.7,
  'curvature': 90,
  'alpha': -2.3,
  'phyllotactic_angle': 180,
  'phyllotactic_deviation': 15,
  'nb_phy': 15,
  'max_leaf_length': 105.71012584433498,
  'wl': 0.11194957780559224,
  'stem_q': 1.1540239470422693,
  'rmax': 0.849411118397879,
  'skew': 0.08984296774162541,
  'phyllochron': 33.12704026193683,
  'plastochron': 43.30263510500918,
  'leaf_duration': 2.021267804677813,
  'stem_duration': 2.5302271765651745,
  'leaf_senescence': 863.974465040651}]</code></pre>
</div>
</div>
<div id="2d4a3d8d-595b-421a-a0e3-311b2547b505" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Align `good_params` to `archi_params` order</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>aligned_good_params <span class="op">=</span> [{key: p[key] <span class="cf">for</span> key <span class="kw">in</span> archi_params.keys()} <span class="cf">for</span> p <span class="kw">in</span> good_params]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize dictionaries for min and max values</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>min_values <span class="op">=</span> {}</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>max_values <span class="op">=</span> {}</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate min and max for each parameter</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> archi_params.keys():</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(archi_params[key], <span class="bu">list</span>):  <span class="co"># Only for list parameters</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract values for this key across all good_params</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        values <span class="op">=</span> [p[key] <span class="cf">for</span> p <span class="kw">in</span> aligned_good_params]</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        min_values[key] <span class="op">=</span> <span class="bu">min</span>(values)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        max_values[key] <span class="op">=</span> <span class="bu">max</span>(values)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Update `archi_params` with min and max for list parameters</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> archi_params.items():</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(value, <span class="bu">list</span>):  <span class="co"># Only update list parameters</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        archi_params[key] <span class="op">=</span> [min_values[key], max_values[key]]</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>[<span class="bu">round</span>(val, <span class="dv">3</span>) <span class="cf">for</span> val <span class="kw">in</span> archi_params[key]]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure all parameters in `archi_params` are lists</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_list(d):</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {k: (v <span class="cf">if</span> <span class="bu">isinstance</span>(v, <span class="bu">list</span>) <span class="cf">else</span> [v]) <span class="cf">for</span> k, v <span class="kw">in</span> d.items()}</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>archi_params <span class="op">=</span> to_list(archi_params)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Display updated `archi_params`</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Updated archi_params:"</span>, archi_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>nb_phy: [10, 15]
max_leaf_length: [88.896, 118.111]
wl: [0.1, 0.116]
stem_q: [1.029, 1.193]
rmax: [0.618, 0.867]
skew: [0.023, 0.09]
phyllochron: [32.494, 44.453]
plastochron: [34.214, 44.456]
leaf_duration: [1.202, 5.48]
stem_duration: [2.53, 4.004]
leaf_senescence: [564.373, 871.884]
Updated archi_params: {'nb_phy': [10, 15], 'max_leaf_length': [88.89606058255535, 118.1105694869254], 'wl': [0.10031167052371445, 0.11604108071175104], 'diam_base': [2.2], 'diam_top': [1.5], 'insertion_angle': [30], 'scurv': [0.7], 'curvature': [90], 'alpha': [-2.3], 'stem_q': [1.0289385173595034, 1.1930546737497694], 'rmax': [0.6177958466512076, 0.8666496205283223], 'skew': [0.02256555190068299, 0.08984296774162541], 'phyllotactic_angle': [180], 'phyllotactic_deviation': [15], 'phyllochron': [32.493791911914386, 44.45272651404066], 'plastochron': [34.21382895687567, 44.45599073202125], 'leaf_duration': [1.2016372244702727, 5.4802652177158215], 'stem_duration': [2.5302271765651745, 4.004192887644081], 'leaf_senescence': [564.3730219089649, 871.8843364675288]}</code></pre>
</div>
</div>
<div id="93e647af-3449-48f8-a022-5241e036dcf2" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">################# in function ##################</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the plants with these parameters</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> interact, interactive, IntSlider, FloatSlider, fixed, Play, HBox, VBox, jslink</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix a seed</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>seed(<span class="dv">100</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>nice_green <span class="op">=</span> Color3((<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">0</span>))</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># slider on parameters with ranges, others fixed </span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>height<span class="op">=</span>height_potential_plant</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>nb_phy_slider<span class="op">=</span>IntSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"nb_phy"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"nb_phy"</span>]), step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">15</span>, description<span class="op">=</span><span class="st">"Nb of phytomers"</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>max_leaf_length_slider<span class="op">=</span>IntSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"max_leaf_length"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"max_leaf_length"</span>]), step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">50</span>, description<span class="op">=</span><span class="st">"Length of longest leaf"</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>wl_slider<span class="op">=</span>FloatSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"wl"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"wl"</span>]), step<span class="op">=</span><span class="fl">0.01</span>, value<span class="op">=</span><span class="fl">0.12</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>diam_base_slider<span class="op">=</span>fixed(archi_params[<span class="st">"diam_base"</span>][<span class="dv">0</span>])</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>diam_top_slider<span class="op">=</span>fixed(archi_params[<span class="st">"diam_top"</span>][<span class="dv">0</span>])</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>insertion_angle_slider<span class="op">=</span>IntSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"insertion_angle"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"insertion_angle"</span>]), step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>scurv_slider<span class="op">=</span>FloatSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"scurv"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"scurv"</span>]), step<span class="op">=</span><span class="fl">0.01</span>, value<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>curvature_slider<span class="op">=</span>IntSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"curvature"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"curvature"</span>]), step<span class="op">=</span><span class="dv">5</span>, value<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>alpha_slider<span class="op">=</span>fixed(archi_params[<span class="st">"alpha"</span>][<span class="dv">0</span>])</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>stem_q_slider<span class="op">=</span>fixed(archi_params[<span class="st">"stem_q"</span>][<span class="dv">0</span>])</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>rmax_slider<span class="op">=</span>FloatSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"rmax"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"rmax"</span>]), step<span class="op">=</span><span class="fl">0.01</span>, value<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>skew_slider<span class="op">=</span>fixed(archi_params[<span class="st">"skew"</span>][<span class="dv">0</span>])</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>phyllotactic_angle_slider<span class="op">=</span>fixed(archi_params[<span class="st">"phyllotactic_angle"</span>][<span class="dv">0</span>])</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>phyllotactic_deviation_slider<span class="op">=</span>IntSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"phyllotactic_deviation"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"phyllotactic_deviation"</span>]), step<span class="op">=</span><span class="dv">5</span>, value<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>phyllochron_slider<span class="op">=</span>IntSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"phyllochron"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"phyllochron"</span>]), step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">55</span>)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>plastochron_slider<span class="op">=</span>IntSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"plastochron"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"plastochron"</span>]), step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">40</span>)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>leaf_duration_slider<span class="op">=</span>FloatSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"leaf_duration"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"leaf_duration"</span>]), step<span class="op">=</span><span class="fl">0.1</span>, value<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>stem_duration_slider<span class="op">=</span>FloatSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"stem_duration"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"stem_duration"</span>]), step<span class="op">=</span><span class="fl">0.1</span>, value<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>leaf_senescence_slider<span class="op">=</span>IntSlider(<span class="bu">min</span><span class="op">=</span><span class="bu">min</span>(archi_params[<span class="st">"leaf_senescence"</span>]), <span class="bu">max</span><span class="op">=</span><span class="bu">max</span>(archi_params[<span class="st">"leaf_senescence"</span>]), step<span class="op">=</span><span class="dv">10</span>, value<span class="op">=</span><span class="dv">800</span>)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>time_slider <span class="op">=</span> IntSlider(value<span class="op">=</span><span class="dv">0</span>, <span class="bu">min</span><span class="op">=</span><span class="dv">0</span>, <span class="bu">max</span><span class="op">=</span><span class="bu">len</span>(time), step<span class="op">=</span><span class="dv">1</span>, description<span class="op">=</span><span class="st">"Time"</span>)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive widget setup</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>play_widget <span class="op">=</span> Play(value<span class="op">=</span><span class="dv">0</span>, <span class="bu">min</span><span class="op">=</span><span class="dv">0</span>, <span class="bu">max</span><span class="op">=</span><span class="bu">len</span>(time), step<span class="op">=</span><span class="dv">1</span>, interval<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Link play widget with time slider</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>jslink((play_widget, <span class="st">'value'</span>), (time_slider, <span class="st">'value'</span>))</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Callback to update scene</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_scene(<span class="op">*</span>args):</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    seed(<span class="dv">100</span>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    sorghum <span class="op">=</span> ArchiCrop(height, nb_phy_slider.value, max_leaf_length_slider.value, wl_slider.value, </span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>                        diam_base_slider.value, diam_top_slider.value, insertion_angle_slider.value, scurv_slider.value, </span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>                        curvature_slider.value, alpha_slider.value, stem_q_slider.value, rmax_slider.value, skew_slider.value, </span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>                        phyllotactic_angle_slider.value, phyllotactic_deviation_slider.value, </span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>                        phyllochron_slider.value, plastochron_slider.value, leaf_duration_slider.value, </span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>                        stem_duration_slider.value, leaf_senescence_slider.value)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>    sorghum.generate_potential_plant()</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    sorghum.define_development()</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>    growing_plant <span class="op">=</span> sorghum.grow_plant(stics_output_data)</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    growing_plant_mtg <span class="op">=</span> <span class="bu">list</span>(growing_plant.values())</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    Viewer.display(build_scene(growing_plant_mtg[time_slider.value], leaf_material <span class="op">=</span> Material(nice_green), stem_material<span class="op">=</span>Material(nice_green))[<span class="dv">0</span>])</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Attach update callback</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>nb_phy_slider.observe(update_scene, names<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>max_leaf_length_slider.observe(update_scene, names<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a><span class="co"># insertion_angle_slider.observe(update_scene, names='value')</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a><span class="co"># scurv_slider.observe(update_scene, names='value')</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="co"># curvature_slider.observe(update_scene, names='value')</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>time_slider.observe(update_scene, names<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Display widgets</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>controls <span class="op">=</span> VBox([nb_phy_slider, max_leaf_length_slider, insertion_angle_slider, scurv_slider, curvature_slider, HBox([time_slider, play_widget])])</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>display(controls)</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial scene display</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>update_scene()</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a><span class="co"># cf github openalea weberpenn trunk_parameters</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a4dff849799d49f9b24a0ee8a750e0ae","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="b5372599-fa93-4772-ae99-1e424f1c26b4" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Calculate covariance matrix</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># covariance_matrix = np.cov(parameters, rowvar=False)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Calculate correlation matrix</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation_matrix = np.corrcoef(parameters, rowvar=False)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # Display results</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Covariance matrix:\n", covariance_matrix)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Correlation matrix:\n", correlation_matrix)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e2e9a6c9-7b99-445a-9085-930bd0b7977f" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from sklearn.decomposition import PCA</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # Perform PCA</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pca = PCA()</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pca.fit(parameters)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # Principal components and explained variance</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Principal components:\n", pca.components_)</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Explained variance ratio:", pca.explained_variance_ratio_)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a13af4ae-32f3-4b80-b513-e579ffcb088c" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from sklearn.cluster import KMeans</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # Perform clustering</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># num_clusters = 2  # Adjust as needed</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># kmeans = KMeans(n_clusters=num_clusters, random_state=42)</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># clusters = kmeans.fit_predict(parameters)</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # Add cluster labels to parameter sets</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Cluster labels:", clusters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b1886e2f-1f68-4eb4-8cf9-00cf36a1126e" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import pandas as pd</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import seaborn as sns</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Heatmap of correlation matrix</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure(figsize=(10, 8))</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.heatmap(correlation_matrix, annot=True, cmap="coolwarm", fmt=".2f")</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title("Parameter Correlation Matrix")</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="within-this-space-of-possible-plant-architectures-regarding-parameters-affecting-plant-leaf-area-and-height-throught-time-we-vary-parameters-related-to-the-orientation-of-the-leaves-in-space-and-to-crop-spatial-configuration." class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="within-this-space-of-possible-plant-architectures-regarding-parameters-affecting-plant-leaf-area-and-height-throught-time-we-vary-parameters-related-to-the-orientation-of-the-leaves-in-space-and-to-crop-spatial-configuration."><span class="header-section-number">5.3</span> Within this space of possible plant architectures regarding parameters affecting plant leaf area and height throught time, we vary parameters related to the orientation of the leaves in space and to crop spatial configuration.</h2>
<div id="0513e1ae-5d54-4764-ac46-b4bdd19fec4e" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>params_to_vary_for_light_it <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    insertion_angle <span class="op">=</span> [<span class="dv">10</span>,<span class="dv">50</span>],</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    scurv <span class="op">=</span> [<span class="fl">0.4</span>,<span class="fl">0.9</span>],</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    curvature <span class="op">=</span> [<span class="dv">35</span>,<span class="dv">130</span>],</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    phyllotactic_deviation <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">45</span>]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>crop_params <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    length_plot <span class="op">=</span> <span class="dv">1</span>, </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    width_plot <span class="op">=</span> <span class="dv">1</span>, </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    sowing_density <span class="op">=</span> sowing_density, <span class="co"># [10, 28], </span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    inter_row <span class="op">=</span> [<span class="fl">0.4</span>, <span class="fl">0.8</span>], <span class="co"># 0.4 for 10</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="933dd09d-69ac-4874-8f95-dbd808e413ed" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TO DO : vary parameters one by one, then together</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stand" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="stand"><span class="header-section-number">5.4</span> Stand</h2>
<div id="44db43ab-9e06-4db2-a590-e044fc901ab2" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sorghum <span class="op">=</span> ArchiCrop(height, <span class="op">**</span>good_params[<span class="dv">0</span>])</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># nb_phy, max_leaf_length, wl, </span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># diam_base, diam_top, insertion_angle, scurv, </span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># curvature, alpha, stem_q, rmax, skew, </span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># phyllotactic_angle, phyllotactic_deviation, </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># phyllochron, plastochron, leaf_duration, </span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># stem_duration, leaf_senescence)</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>sorghum.generate_potential_plant()</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>scene <span class="op">=</span> sorghum.display_stand(sowing_density<span class="op">=</span>sowing_density, length_plot<span class="op">=</span><span class="dv">1</span>, width_plot<span class="op">=</span><span class="dv">1</span>, inter_row<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>PlantGL(scene)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9d1b9e676a59496d951254f24d613108","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="90e176c6-1d13-4241-9e3a-6c4f4fb4f47f" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store scenes for MTG at all times</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>sorghum.define_development()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>growing_plant <span class="op">=</span> sorghum.grow_plant(stics_output_data)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>nplants, positions, domain, domain_area, unit <span class="op">=</span> agronomic_plot(length<span class="op">=</span><span class="dv">1</span>, width<span class="op">=</span><span class="dv">1</span>, sowing_density<span class="op">=</span><span class="dv">10</span>, inter_row<span class="op">=</span><span class="fl">0.4</span>, noise<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>scenes <span class="op">=</span> {}</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k,v <span class="kw">in</span> growing_plant.items():</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    scene, nump <span class="op">=</span> build_scene([v]<span class="op">*</span>nplants, positions, leaf_material<span class="op">=</span>Material(nice_green), stem_material<span class="op">=</span>Material(nice_green))</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    scenes[k] <span class="op">=</span> scene</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compute-par-intercepted" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="compute-par-intercepted"><span class="header-section-number">5.5</span> Compute PAR intercepted</h2>
<div id="058b521b-1b5d-464c-ab08-9d9d50dac534" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>nplants, positions, domain, domain_area, unit <span class="op">=</span> agronomic_plot(length<span class="op">=</span><span class="dv">1</span>, width<span class="op">=</span><span class="dv">1</span>, sowing_density<span class="op">=</span><span class="dv">10</span>, inter_row<span class="op">=</span><span class="fl">0.4</span>, noise<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>par_caribu <span class="op">=</span> []</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>scenes <span class="op">=</span> []</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Start the timer</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> t.time()</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> params <span class="kw">in</span> good_params:</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    sorghum <span class="op">=</span> ArchiCrop(height, <span class="op">**</span>params)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    sorghum.generate_potential_plant()</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    sorghum.define_development()</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    growing_plant <span class="op">=</span> sorghum.grow_plant(stics_output_data)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    scenes_temp <span class="op">=</span> {}</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k,v <span class="kw">in</span> growing_plant.items():</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        scene, nump <span class="op">=</span> build_scene([v]<span class="op">*</span>nplants, positions, leaf_material<span class="op">=</span>Material(nice_green), stem_material<span class="op">=</span>Material(nice_green))</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>        scenes_temp[k] <span class="op">=</span> scene</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    scenes.append(scenes_temp)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    par_caribu_temp <span class="op">=</span> []</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> scene <span class="kw">in</span> scenes_temp.values():</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>        par_caribu_temp.append(compute_light_inter(scene))</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    par_caribu.append(par_caribu_temp)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co"># End the timer</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>end_time <span class="op">=</span> t.time()</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate elapsed time</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>elapsed_time <span class="op">=</span> (end_time <span class="op">-</span> start_time)<span class="op">/</span><span class="dv">60</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Elapsed time: </span><span class="sc">{</span>elapsed_time<span class="sc">:.4f}</span><span class="ss"> minutes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Elapsed time: 20.7545 minutes</code></pre>
</div>
</div>
<div id="9120177a-8782-41a5-acb1-b1219f9fe7fe" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a NumPy array for easier manipulation</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,par <span class="kw">in</span> <span class="bu">enumerate</span>(par_caribu):</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j,p <span class="kw">in</span> <span class="bu">enumerate</span>(par):</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        par_caribu[i][j] <span class="op">/=</span> <span class="dv">10</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>curves <span class="op">=</span> par_caribu</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>curves_array <span class="op">=</span> np.array(curves)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the envelope: min and max values for each time point</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>min_values <span class="op">=</span> curves_array.<span class="bu">min</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>max_values <span class="op">=</span> curves_array.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the envelope along with individual curves for context</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>time_points <span class="op">=</span> time</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> curve <span class="kw">in</span> curves:</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    plt.plot(time_points, curve, alpha<span class="op">=</span><span class="fl">0.5</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)  <span class="co"># Plot each curve (optional for visualization)</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>plt.fill_between(time_points, min_values, max_values, color<span class="op">=</span><span class="st">"skyblue"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>plt.plot(time_points, min_values, color<span class="op">=</span><span class="st">"blue"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, label<span class="op">=</span><span class="st">"Min 3D"</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>plt.plot(time_points, max_values, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, label<span class="op">=</span><span class="st">"Max 3D"</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>plt.plot(time_points, par_stics, color<span class="op">=</span><span class="st">"black"</span>, label<span class="op">=</span><span class="st">"STICS"</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.scatter(time_points, LA_stics)</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Labels and legend</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Thermal time"</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"</span><span class="sc">% o</span><span class="st">f absorbed PAR"</span>)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Absorbed PAR: 3D canopy vs. STICS"</span>)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="light_inter_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="compute-beer-lambert-light-extinction-coefficient-at-each-time-step" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="compute-beer-lambert-light-extinction-coefficient-at-each-time-step"><span class="header-section-number">5.6</span> Compute Beer-Lambert light extinction coefficient at each time step</h2>
<section id="light-interception-in-stics" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="light-interception-in-stics"><span class="header-section-number">5.6.1</span> Light interception in STICS</h3>
<p>The radiation intercepted by the crop <span class="math inline">\(raint\)</span> is expressed according to a Beer’s law function of <span class="math inline">\(lai\)</span>. The <span class="math inline">\(extinP\)</span> parameter is a daily extinction coefficient and <span class="math inline">\(parsurrgG\)</span> is a climatic parameter corresponding to the ratio (in radiative energy) of photosynthetically active radiation to the global radiation <span class="math inline">\(trg(t)\)</span> (around 0.48, Varlet-Grancher et al.&nbsp;(1982)).</p>
<p><span class="math display">\[raint(t)=0.95*parsurrgG*trg(t)*(1−exp^{−extinP*(lai(t)+eai(t))})\]</span></p>
<p><span class="math display">\[extinP = - \frac{1}{lai(t)+eai(t)} ln(1 - \frac{raint(t)}{0.95*parsurrgG*trg(t)})\]</span></p>
<p><span class="math display">\[extinP = - \frac{1}{lai(t)+eai(t)} ln(1 - ratio\_par\_abs)\]</span></p>
<p>extin_stics = 0.7</p>
<div id="e568f160-72b4-4cf6-83a6-9ac227cba7f0" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute coef extinP</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>extinP_list <span class="op">=</span> []</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> par_time_series <span class="kw">in</span> par_caribu:</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    extinP_per_sim <span class="op">=</span> []</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i,par <span class="kw">in</span> <span class="bu">enumerate</span>(par_time_series):</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> par <span class="op">&lt;</span> <span class="dv">1</span>:</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>            lai <span class="op">=</span> LAI_stics[i]<span class="op">*</span>sowing_density<span class="op">/</span><span class="dv">10000</span> </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>            extinP <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">/</span>lai <span class="op">*</span> math.log(<span class="dv">1</span><span class="op">-</span>par)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>            extinP <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        extinP_per_sim.append(extinP)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    extinP_list.append(extinP_per_sim)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>time_points <span class="op">=</span> time[<span class="dv">1</span>:]</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> curve <span class="kw">in</span> extinP_list:</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    plt.plot(time_points, curve, alpha<span class="op">=</span><span class="fl">0.5</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg ansi-bold">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg ansi-bold">In[20], line 9</span>
<span class="ansi-green-fg">      7</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> i,par <span style="font-weight:bold;color:rgb(175,0,255)">in</span> <span style="color:rgb(0,135,0)">enumerate</span>(par_time_series):
<span class="ansi-green-fg">      8</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> par <span style="color:rgb(98,98,98)">&lt;</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg ansi-bold">----&gt; 9</span>         lai <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">LAI_stics</span>[i]<span style="color:rgb(98,98,98)">*</span>sowing_density<span style="color:rgb(98,98,98)">/</span><span style="color:rgb(98,98,98)">10000</span> 
<span class="ansi-green-fg">     10</span>         extinP <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">1</span><span style="color:rgb(98,98,98)">/</span>lai <span style="color:rgb(98,98,98)">*</span> math<span style="color:rgb(98,98,98)">.</span>log(<span style="color:rgb(98,98,98)">1</span><span style="color:rgb(98,98,98)">-</span>par)
<span class="ansi-green-fg">     11</span>     <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:

<span class="ansi-red-fg ansi-bold">NameError</span>: name 'LAI_stics' is not defined</pre>
</div>
</div>
</div>
<div id="a1c266d7-209b-4a92-b0b5-86ebde13b4cb" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># courbe parameters beer-lambert --&gt; analysis of decomposition of uncertainty, parametric</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="next-steps" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="next-steps"><span class="header-section-number">5.7</span> Next steps</h2>
<ul>
<li>Simulations to run with IFB Cloud</li>
</ul>


</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./algo_leaf_growth.html" class="pagination-link" aria-label="Algorithm for leaf growth">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Algorithm for leaf growth</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./year_2.html" class="pagination-link" aria-label="Second chapter : Analyzing accuracy of formalisms in crop model when adding root structural variability">
        <span class="nav-page-text">Second chapter : Analyzing accuracy of formalisms in crop model when adding root structural variability</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>